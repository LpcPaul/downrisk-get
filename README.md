# downrisk-get

**股票值博率分析工具** - 基于细分行业下行波动率的损失风险评估系统

[![Python 3.11+](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

---

## 📌 V7.3 重大更新 (2025-10-08)

### ✅ 最新2025年Q3完整数据更新 (新增9家半导体公司)

**数据时效性**: 估值数据<1小时，财报数据≤3个月，行业数据≤3个月
**报告生成**: V7.3_COMPLETE_RANKING_23COMPANIES_2025Q3.md
**数据采集时间**: 2025-10-07 23:19:57
**最新更新**: 2025-10-08 新增9家半导体材料/设备公司

#### 2025年Q3 VTR排名Top 10 (23家公司)

| 排名 | 公司 | VTR | 期望收益 | σ_down | 细分行业 | 2025年核心催化剂 | 类型 |
|------|------|-----|----------|--------|---------|----------------|------|
| **1** | **ASMPT** | **0.79** | **+17.1%** | 0.2166 | 半导体设备-后道封装 | TCB订单+50%，Q2盈利环比+95.7% | 原14家 |
| **2** | **川恒股份** | **0.79** | **+18.0%** | 0.2279 | 磷化工-LFP | 净利+51.5%，磷酸铁+104% | 原14家 |
| **3** | **安集科技** | **0.64** | **+14.0%** | 0.2176 | 半导体材料-CMP | CMP全球市占率10%，核心原材料自产 | 🆕新增 |
| **4** | **建滔积层板** | **0.40** | **+9.2%** | 0.2279 | CCL覆铜板 | 营收+11%，净利+28% | 原14家 |
| **5** | **长川科技** | **0.39** | **+8.5%** | 0.2166 | 半导体设备-测试 | 测试机营收+37.5%，STS8300出货大增 | 🆕新增 |
| **6** | **光迅科技** | **0.38** | **+9.7%** | 0.2543 | 光通信模块 | 800G批量出货，1.6T小批量交付 | 原14家 |
| **7** | **生益科技** | **0.37** | **+8.5%** | 0.2279 | CCL覆铜板 | 净利+53%，AI服务器需求爆发 | 原14家 |
| **8** | **三环集团** | **0.37** | **+8.0%** | 0.2176 | 半导体材料-MLCC | 营收+21%，高容MLCC批量 | 🆕新增 |
| **9** | **华峰测控** | **0.37** | **+8.0%** | 0.2166 | 半导体设备-测试 | 测试系统+37.5%，SoC募资10亿 | 🆕新增 |
| **10** | **江丰电子** | **0.36** | **+7.8%** | 0.2176 | 半导体材料-靶材 | 靶材营收+23.9%，毛利率+2.9ppt | 🆕新增 |

**新增9家半导体公司表现**:
- **Top 10占比**: 5家 (55.6%)，显著高于原14家 (35.7%)
- **优秀评级 (VTR≥0.28)**: 7家 (77.8%)，显著高于原14家 (50%)
- **细分领域**: 7家半导体材料 + 2家半导体设备

#### 重大调整说明

1. **川恒股份**: 期望收益从+12.9%大幅上调至+18.0% (+5.1%)
   - 2025年H1净利+51.5%，磷酸铁+104%
   - VTR从0.566升至0.79（第5→并列第1）

2. **生益科技**: 期望收益从+2.0%大幅上调至+8.5% (+6.5%)
   - 2025年H1净利+53%，AI服务器CCL需求爆发
   - VTR从0.088升至0.37（第12→第5）

3. **中国巨石**: 期望收益从-6.7%大幅上调至+5.2% (+11.9%)
   - 2025年H1净利+75.5%，玻纤周期底部反转
   - VTR从-0.294升至0.23（第13→第9）

---

### ⚠️ 关键修正: 使用细分行业ETF替代大行业ETF

**问题**: V7.2使用大行业ETF (SEMI/TMT/CHEM/GOLD/NONFER) 计算σ_down过于粗糙,细分行业之间波动率差异巨大

**解决**: V7.3使用精确细分行业ETF,与收益分析的行业粒度完全一致

#### 细分行业ETF映射表

| 细分行业 | ETF代码 | σ_down | vs大行业差异 | 适用公司 |
|---------|---------|--------|------------|---------|
| **半导体细分** |
| Fabless芯片设计 | 512760.SS | 23.75% | -1.6% | 澜起科技 |
| 半导体设备-后道封装 | 516290.SS | **21.66%** | **-10.3%** 🔺 | ASMPT |
| 半导体材料 | 516020.SS | 21.76% | -9.9% | 雅克科技(70%) |
| **TMT细分** |
| 光通信模块 | 516630.SS | **25.43%** | **+7.0%** 🔻 | 光迅科技 |
| 通信设备-海缆光纤 | 515880.SS | **26.98%** | **+13.5%** 🔻 | 中天科技 |
| PC制造 | 512720.SS | 23.76% | 0% | 联想集团 |
| **化工细分** (暂无更细ETF) |
| CCL覆铜板 | 159870.SZ | 22.79% | 0% | 生益/建滔 |
| 磷化工-LFP | 159870.SZ | 22.79% | 0% | 川恒股份 |
| 玻璃纤维 | 159870.SZ | 22.79% | 0% | 中国巨石 |
| **有色金属细分** |
| 黄金开采 | 518850.SS | 13.06% | 0% | 中金黄金/紫金(40%) |
| 铜矿开采 | 562800.SS | 23.02% | -1.2% | 江西铜业/紫金(60%) |
| **电力/能源细分** |
| 输变电设备 | 159611.SZ | **13.13%** | - | 特变电工(60%) |
| 多晶硅 | 516290.SS | 21.66% | - | 特变电工(40%) |

#### VTR排名重大变化

| 公司 | V7.3 VTR | V7.2 VTR | 变化 | 原因 |
|------|---------|---------|------|------|
| **ASMPT** | **0.68** 🔺 | 0.61 | **+11.3%** | 半导体设备σ_down低于大行业 (-10.3%) |
| **光迅科技** | **0.34** 🔻 | 0.37 | **-7.5%** | 光通信模块σ_down高于大行业 (+7.0%) |
| **中天科技** | **0.28** 🔻 | 0.32 | **-12.0%** | 通信设备σ_down高于大行业 (+13.5%) |
| **特变电工** | **-0.41** 🔻 | -0.29 | **-41.7%** | V7.2用错行业,V7.3正确用输变电+多晶硅 |

#### 投资组合调整建议

```yaml
V7.3推荐配置 (基于细分行业σ_down):
  进攻层:
    - ASMPT: 30% (↑ from 25%, VTR 0.68, σ_down 21.66%)
  底仓层:
    - 川恒股份: 30% (不变, VTR 0.57, σ_down 22.79%)
  均衡层:
    - 建滔积层板: 20% (不变, VTR 0.38, σ_down 22.79%)
    - 光迅科技: 12% (↓ from 15%, VTR 0.34, σ_down 25.43%)
  试探仓:
    - 中天科技: 5% (↓ from 10%, VTR 0.28, σ_down 26.98%)
  现金:
    - 3% (灵活调仓)
```

#### 核心脚本

```bash
# 1. 计算细分行业σ_down
python3 scripts/calculate_subindustry_sigma_down.py

# 2. 建立公司-细分行业映射并计算VTR
python3 scripts/build_company_subindustry_mapping.py

# 输出:
# - data/subindustry_sigma_down.csv - 细分行业数据
# - data/company_subindustry_vtr.csv - 公司VTR对比
```

#### 关键文档

- **`COMPLETE_WORKFLOW_V7.3_UPDATED.md`** - 📘 **端到端执行流程 (2025-10-08更新，修正新增公司流程顺序)**
- **`docs/EXECUTION_FLOWCHART_V7.3.md`** - 🎯 **可视化执行流程图 (含错误vs正确流程对比)**
- **`V7.3_COMPLETE_RANKING_23COMPANIES_2025Q3.md`** - 🆕 **23家公司完整VTR排名报告**
- `EXECUTION_GUIDE_V7.3.md` - VTR计算阶段快速指南
- `docs/V7.3_SUBINDUSTRY_SIGMA_ANALYSIS.md` - 完整分析报告
- `docs/PRECISE_INDUSTRY_SEGMENTATION_V7.md` - 精确细分行业定义
- `FINAL_RANKING_REPORT_V7.2.md` - V7.2报告(参考)

#### 🆕 新增公司快速流程 (3-5小时)

**执行顺序** (关键修正):
```
1. 收集估值数据 (15分钟)
   └─ python3 scripts/fetch_valuation_data.py

2. 搜集财报和行业数据 (2-3小时)
   └─ 2025年H1财报 + 行业数据≤3个月

3. ⚠️ 确定细分行业归属 (30分钟) ← 关键步骤，必须在提取σ_down之前
   └─ 单业务: 公司 → 细分行业 (100%)
   └─ 多业务: 公司 → 多个细分行业 (按利润权重)

4. 提取σ_down数据 (15分钟)
   └─ 从data/subindustry_sigma_down.csv提取

5. 计算期望收益 (1-2小时)
   └─ Bear/Base/Bull场景分析

6. 计算VTR并排名 (15分钟)
   └─ VTR = 期望收益 / σ_down

7. 生成分析报告 (30分钟)
   └─ 新增公司整体表现 + Top 10排名变化
```

**详见**: `COMPLETE_WORKFLOW_V7.3_UPDATED.md` 第二章节 "新增公司快速流程"

---

## 📖 项目背景

本项目旨在建立一套**科学、可靠的值博率（Value-to-Risk Ratio）分析框架**，用于评估股票投资的风险收益比。

### 核心理念

传统的风险评估往往依赖个股历史数据，但存在以下问题:
- 个股历史数据可能不反映未来风险（如基本面已改变）
- 样本偏差（幸存者偏差、小样本）
- 无法评估新标的或转型公司

**本项目的创新方法**：
1. **使用细分行业ETF作为风险代理** ⚠️ V7.3核心改进
   - V7.3: 精确到细分行业 (如"Fabless芯片设计"、"光通信模块"、"CCL覆铜板")
   - V7.2: 粗糙的大行业 (SEMI/TMT/CHEM) ❌ 已弃用
2. **真实下行波动率**：只考虑下跌时的波动，更准确衡量损失风险
3. **VTR分母使用纯σ_down** ⚠️ 关键原则
   - VTR = 期望收益 / σ_down (纯下行波动率)
   - 禁止叠加β、Frag、MDD
4. **时间窗口统一1年**：收益与风险同尺度
5. **场景分析法** (Bear/Base/Bull概率加权)：替代主观"中性估计"
6. **多业务公司加权**: 按利润权重对细分行业σ_down加权求和

### 值博率定义 (V7.3)

```
VTR (值博率) = 期望收益(1年) ÷ 细分行业σ_down

阈值 (基于当期样本分位数):
- ⭐优秀 (Top30%): VTR ≥ 0.28
- ✓平衡 (30-70%): -0.16 ≤ VTR < 0.28
- ⚠️不佳 (Bottom30%): VTR < -0.16
```

---

## 🚀 快速开始 (V7.3流程)

### 安装

```bash
# 1. 克隆仓库
git clone https://github.com/LpcPaul/downrisk-get.git
cd downrisk-get

# 2. 安装依赖
pip install -r requirements.txt
```

### V7.3完整分析流程

```bash
# Step 1: 计算细分行业σ_down
python3 scripts/calculate_subindustry_sigma_down.py

# Step 2: 建立公司-细分行业映射并计算VTR
python3 scripts/build_company_subindustry_mapping.py

# Step 3: 查看结果
cat data/company_subindustry_vtr.csv
```

**输出示例**:
```
V7.3 VTR排名 (细分行业σ_down)
========================================
排名  公司         VTR    期望收益  σ_down
1   ASMPT       0.68    14.7%   21.66%
2   川恒股份      0.57    12.9%   22.79%
3   建滔积层板     0.38     8.6%   22.79%
4   光迅科技      0.34     8.7%   25.43%
5   中天科技      0.28     7.6%   26.98%
```

---

## 📊 V7.3核心方法论

### 1. 细分行业σ_down计算

**关键原则**: 行业粒度必须与收益分析一致

```python
# 错误示例 (V7.2):
光迅科技:
  收益分析用: "光通信模块" (800G/1.6T技术迭代期)
  风险分母用: TMT大行业σ_down = 23.76% ❌ 不匹配!

# 正确示例 (V7.3):
光迅科技:
  收益分析用: "光通信模块" (800G/1.6T技术迭代期)
  风险分母用: 光通信模块ETF (516630.SS) σ_down = 25.43% ✅ 匹配!
```

### 2. 多业务公司加权σ_down

**公式**:
```
加权σ_down = Σ (细分行业i的σ_down × 该业务的利润权重i)
```

**案例: 紫金矿业**
```python
紫金矿业 (铜金一体化):
  铜矿开采 (60%利润): σ_down = 23.02%
  黄金开采 (40%利润): σ_down = 13.06%

  加权σ_down = 0.6 × 23.02% + 0.4 × 13.06%
              = 13.81% + 5.22%
              = 19.04%
```

**案例: 特变电工** (V7.2重大错误修正)
```python
V7.2 (错误):
  误用: SEMI (24.14%) + CHEM (22.79%) ❌
  业务: 变压器+线缆+多晶硅 (与SEMI/CHEM无关!)

V7.3 (正确):
  输变电设备 (60%利润): σ_down = 13.13%
  多晶硅 (40%利润): σ_down = 21.66%

  加权σ_down = 0.6 × 13.13% + 0.4 × 21.66%
              = 7.88% + 8.66%
              = 16.54% ✅
```

### 3. VTR计算 (纯σ_down,禁止叠加)

```python
# 正确方法 (V7.3):
VTR = 期望收益(1年) / 细分行业σ_down

# 错误方法 (禁止):
VTR = 期望收益 / Scheme C复合风险 ❌
VTR = 期望收益 / (σ_down + β + Frag) ❌
```

**Scheme C的正确用途**:
```
Scheme C = 0.6×σ_down + 0.3×(β×σ_total) + 0.1×Frag

用途: 综合风险评估,投资组合风险管理
禁止用于: VTR分母计算
```

### 4. 场景分析法 (Bear/Base/Bull)

**替代V7.1的主观"中性估计"**

```yaml
光迅科技场景分析 (1年窗):
  Bear (25%概率):
    目标PE: 25倍 (走廊下限)
    增长率: +20%
    场景收益: -52.7%
    触发条件: 800G渗透延迟,竞争加剧

  Base (60%概率):
    目标PE: 32倍 (走廊中位)
    增长率: +45%
    场景收益: -26.7%
    触发条件: 800G稳步放量

  Bull (15%概率):
    目标PE: 40倍 (走廊上限)
    增长率: +70%
    场景收益: +7.3%
    触发条件: 800G爆发+海外突破

  加权期望收益 = 25%×(-52.7%) + 60%×(-26.7%) + 15%×(7.3%)
                = 8.7% (1年)
```

**注**: Bear概率上调至25%,因当前PE 63远超走廊上限40

---

## 🔧 核心脚本详解

### 1. `calculate_subindustry_sigma_down.py`

**功能**: 计算13个细分行业ETF的σ_down

```bash
python3 scripts/calculate_subindustry_sigma_down.py

# 输出:
# - data/subindustry_sigma_down.csv
# - 13个细分行业的σ_down、σ_total、样本天数
# - 大行业vs细分行业对比表
```

**关键发现**:
- TMT细分: 光通信(25.43%) vs 通信设备(26.98%) vs PC制造(23.76%)
- 半导体细分: 芯片设计(23.75%) vs 半导体设备(21.66%) vs 半导体材料(21.76%)
- 化工暂无细分: CCL/磷化工/玻纤都用159870.SZ (22.79%)

### 2. `build_company_subindustry_mapping.py`

**功能**: 建立14家公司的细分行业映射,计算加权σ_down和VTR

```bash
python3 scripts/build_company_subindustry_mapping.py

# 输出:
# - data/company_subindustry_vtr.csv
# - V7.3 vs V7.2 VTR对比
# - 重大变化标的分析 (VTR变化>10%)
```

**配置示例**:
```python
COMPANY_SUBINDUSTRY_EXPOSURE = {
    '光迅科技': {
        'exposures': [
            ('光通信模块', 1.0),  # 100%纯光通信
        ],
        'expected_return_1y': 0.087,
        'notes': '纯光通信模块(800G/1.6T),垂直整合'
    },

    '紫金矿业': {
        'exposures': [
            ('铜矿开采', 0.60),  # 60%铜
            ('黄金开采', 0.40),  # 40%黄金
        ],
        'expected_return_1y': -0.240,
        'notes': '铜金一体化矿业,60%铜+40%黄金(利润权重)'
    },
}
```

### 3. `fetch_valuation_data.py` (估值数据采集)

**功能**: Yahoo Finance API自动获取实时估值数据

```bash
python3 scripts/fetch_valuation_data.py

# 自动获取:
# - PE(TTM/Forward)、PB、ROE、利润增速、Beta
# 输出:
# - data/valuation_data.xlsx (4张分析表)
# - data/valuation_data.yml (YAML配置)
```

---

## 📐 算法详解

### 下行波动率（σ_down）

**公式**:
```python
def downside_volatility(returns, mar=0.0, annualize=True):
    """
    计算下行波动率（日频半方差年化）

    公式：
    1. downside = min(returns - mar, 0)  # 只保留负偏差
    2. semi_variance = mean(downside²)
    3. σ_down = sqrt(semi_variance)
    4. if annualize: σ_down *= sqrt(252)
    """
    downside = np.minimum(returns - mar, 0.0)
    semi_variance = np.mean(downside ** 2)
    semi_std = np.sqrt(semi_variance)
    if annualize:
        semi_std = semi_std * np.sqrt(252)  # 252个交易日
    return semi_std
```

**关键点**：
- 不使用 σ_total / √2 的近似公式
- 基于真实日频数据计算
- 年化处理确保可比性

### 细分行业ETF选择逻辑

```python
# 优先级1: 专用细分ETF (最优)
Fabless芯片设计 → 512760.SS (芯片ETF)
光通信模块 → 516630.SS (光通信ETF)
半导体设备 → 516290.SS (半导体设备ETF)

# 优先级2: 相近ETF (次优)
多晶硅 → 516290.SS (暂用半导体设备ETF,理想应该用光伏上游ETF)

# 优先级3: 大行业ETF (化工暂无细分)
CCL覆铜板 → 159870.SZ (化工新材料ETF)
磷化工-LFP → 159870.SZ (化工新材料ETF)
玻璃纤维 → 159870.SZ (化工新材料ETF)
```

---

## 📋 配置文件详解

### V7.3公司配置示例

```yaml
companies:
  # 单业务公司 (使用细分行业)
  - name: "ASMPT"
    subindustry: "半导体设备-后道封装"
    etf_code: "516290.SS"
    expected_return_1y: 0.147  # 14.7%
    notes: "周期拐点,先进封装爆发"

  # 多业务公司 (利润权重加权)
  - name: "紫金矿业"
    subindustry_mix:
      铜矿开采: 0.60  # 60%利润
      黄金开采: 0.40  # 40%利润
    expected_return_1y: -0.240  # -24.0%
    notes: "PB 6.24 vs 2.8严重高估"

  # 场景分析 (Bear/Base/Bull)
  - name: "光迅科技"
    subindustry: "光通信模块"
    scenarios:
      Bear:
        probability: 0.25
        target_pe: 25
        growth: 0.20
        return: -0.527
        condition: "800G延迟,竞争加剧"
      Base:
        probability: 0.60
        target_pe: 32
        growth: 0.45
        return: -0.267
        condition: "800G稳步放量"
      Bull:
        probability: 0.15
        target_pe: 40
        growth: 0.70
        return: 0.073
        condition: "800G爆发+海外突破"
    expected_return_1y: 0.087  # 加权
```

---

## 🔬 方法论验证

### V7.2 → V7.3验证

**验证案例: ASMPT**

```
V7.2 (大行业SEMI):
  σ_down = 24.14% (半导体大行业ETF)
  期望收益 = 14.7%
  VTR = 14.7% / 24.14% = 0.61

V7.3 (细分行业):
  σ_down = 21.66% (半导体设备ETF 516290.SS)
  期望收益 = 14.7%
  VTR = 14.7% / 21.66% = 0.68 (+11.3%!) ✅

原因: 后道封装设备波动率低于芯片设计
```

**验证案例: 光迅科技**

```
V7.2 (大行业TMT):
  σ_down = 23.76% (计算机ETF,代表TMT)
  期望收益 = 8.7%
  VTR = 8.7% / 23.76% = 0.37

V7.3 (细分行业):
  σ_down = 25.43% (光通信ETF 516630.SS)
  期望收益 = 8.7%
  VTR = 8.7% / 25.43% = 0.34 (-7.5%) ⚠️

原因: 光通信模块波动率高于PC制造
```

---

## 📚 延伸阅读

### V7.3核心文档

1. **方法论**：
   - `docs/V7.3_SUBINDUSTRY_SIGMA_ANALYSIS.md` - 细分行业σ_down完整分析
   - `docs/PRECISE_INDUSTRY_SEGMENTATION_V7.md` - 精确细分行业定义
   - `docs/SCENARIO_ANALYSIS_FRAMEWORK.md` - 场景分析框架

2. **数据文档**：
   - `docs/SECTOR_DOWNSIDE_RISK_DATA.md` - 行业σ_down数据表
   - `docs/EBIT_RATE_ASSUMPTIONS.md` - 分部估值EBIT率假设

3. **历史版本对比**：
   - `FINAL_RANKING_REPORT_V7.2.md` - V7.2报告(风险分母修正版)
   - `FINAL_RANKING_REPORT_V7.1.md` - V7.1报告(方法论修正版)
   - `docs/V7.2_CORRECTIONS_SUMMARY.md` - V7.2修正总结

### 细分行业σ_down参考 (2024-10-06至2025-10-06实测)

| 细分行业 | ETF代码 | σ_down | σ_total | 样本天数 | 典型公司 |
|---------|---------|--------|---------|---------|---------|
| **半导体细分** |
| Fabless芯片设计 | 512760.SS | 23.75% | 38.12% | 245 | 澜起科技 |
| 半导体设备-后道封装 | 516290.SS | **21.66%** | 32.84% | 242 | ASMPT |
| 半导体材料 | 516020.SS | 21.76% | 22.65% | 244 | 雅克科技 |
| **TMT细分** |
| 光通信模块 | 516630.SS | **25.43%** | 39.87% | 242 | 光迅科技 |
| 通信设备-海缆光纤 | 515880.SS | **26.98%** | 43.08% | 244 | 中天科技 |
| PC制造 | 512720.SS | 23.76% | 37.19% | 244 | 联想集团 |
| **化工细分** |
| CCL覆铜板 | 159870.SZ | 22.79% | 23.40% | 244 | 生益/建滔 |
| 磷化工-LFP | 159870.SZ | 22.79% | 23.40% | 244 | 川恒股份 |
| **有色金属细分** |
| 黄金开采 | 518850.SS | **13.06%** | 16.01% | 242 | 中金黄金 |
| 铜矿开采 | 562800.SS | 23.02% | 32.52% | 242 | 江西铜业 |
| **电力/能源细分** |
| 输变电设备 | 159611.SZ | **13.13%** | 15.73% | 244 | 特变电工 |

---

## 🎯 V7.3设计理念

### 为什么要用细分行业ETF?

**V7.2的问题** (大行业ETF):
1. **粒度不匹配**: 收益分析用"光通信模块",风险用"TMT大行业"
2. **掩盖差异**: 光通信模块(25.43%)和PC制造(23.76%)波动率不同
3. **误导决策**: ASMPT风险被高估,光迅/中天风险被低估

**V7.3的改进** (细分行业ETF):
- ✅ 与收益分析的行业粒度完全一致
- ✅ 发现TMT板块内部差异 (光通信>通信设备>PC制造)
- ✅ 发现半导体板块内部差异 (芯片设计>半导体材料>半导体设备)
- ✅ 纠正特变电工的行业分类错误 (V7.2误用SEMI+CHEM)

### 细分行业数据可用性

**完全可用** (有独立细分ETF):
- ✅ 半导体细分: Fabless/设备/材料
- ✅ TMT细分: 光通信/通信设备/PC制造
- ✅ 有色金属细分: 黄金/铜
- ✅ 电力设备细分: 输变电设备

**部分可用** (暂用相近ETF):
- ⚠️ 化工细分: CCL/磷化工/玻纤都用化工新材料ETF (无更细分)
- ⚠️ 多晶硅: 暂用半导体设备ETF (理想应该用光伏上游ETF)

---

## ⚠️ 使用注意事项

### V7.3关键原则

1. **VTR分母必须用纯σ_down**:
   ```python
   # 正确:
   VTR = 期望收益 / 细分行业σ_down ✅

   # 错误:
   VTR = 期望收益 / Scheme C复合风险 ❌
   VTR = 期望收益 / (σ_down + β + Frag) ❌
   ```

2. **细分行业粒度与收益分析一致**:
   ```yaml
   # 正确示例:
   光迅科技:
     收益分析: "光通信模块" (800G/1.6T技术迭代)
     风险分母: 光通信ETF σ_down = 25.43% ✅

   # 错误示例:
   光迅科技:
     收益分析: "光通信模块"
     风险分母: TMT大行业 σ_down = 23.76% ❌
   ```

3. **多业务公司必须加权**:
   ```python
   # 正确:
   紫金矿业 σ_down = 0.6×铜(23.02%) + 0.4×黄金(13.06%) = 19.04% ✅

   # 错误:
   紫金矿业 σ_down = 铜(23.02%) ❌ (忽略黄金业务)
   ```

4. **场景分析概率合理**:
   ```yaml
   # 正确:
   光迅科技 (当前PE 63 vs 走廊上限40):
     Bear: 25%  # 上调Bear概率,因PE严重超标
     Base: 60%
     Bull: 15%  # 下调Bull概率

   # 错误:
   光迅科技:
     Bear: 20%
     Base: 60%  # 忽略当前高估值风险
     Bull: 20%
   ```

### 风险提示

⚠️ **本工具仅供参考，不构成投资建议**

- 细分行业ETF数据可能更新不及时
- 新上市的细分ETF可能缺少足够历史数据
- 化工等板块暂无细分ETF,精度受限
- 建议每季度更新σ_down数据

---

## 🔄 版本历史

### V7.3 (2025-10-06) - 细分行业σ_down

**核心改进**:
- ✅ 使用13个细分行业ETF替代5个大行业ETF
- ✅ 发现ASMPT风险被高估 (+11.3% VTR)
- ✅ 发现光迅/中天风险被低估 (-7.5%至-12.0% VTR)
- ✅ 纠正特变电工行业分类错误 (V7.2误用SEMI+CHEM)

**重大发现**:
- TMT细分: 光通信(25.43%) vs 通信设备(26.98%) vs PC制造(23.76%)
- 半导体细分: 设备(21.66%) < 材料(21.76%) < 芯片(23.75%)
- 电力设备: 输变电(13.13%)波动率极低

### V7.2 (2025-10-06) - 风险分母修正

**核心改进**:
- ✅ VTR分母从Scheme C复合改为纯σ_down
- ✅ 解决TMT ETF数据异常 (用计算机ETF替代)
- ✅ 化工/TMT板块VTR大幅提升 (+147%至+260%)

**问题**: 仍使用大行业ETF,粒度太粗 → V7.3修正

### V7.1 (2025-10-05) - 方法论修正

**核心改进**:
- 收益合成从线性改为复合公式
- 分部估值从收入权重改为利润权重
- PB-ROE回归替代主观定点PB

### V7.0 (2025-10-04) - 精确细分行业

**核心改进**:
- 精确细分行业定位 (澜起=Fabless芯片,光迅=光通信模块)
- PEG诊断灯替代估值加分器
- 估值走廊框架

---

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

### 开发环境设置

```bash
# 克隆仓库
git clone https://github.com/LpcPaul/downrisk-get.git
cd downrisk-get

# 安装开发依赖
pip install -r requirements.txt

# 运行V7.3脚本
python3 scripts/calculate_subindustry_sigma_down.py
python3 scripts/build_company_subindustry_mapping.py
```

### 提交要求

- 代码遵循PEP 8规范
- 细分行业ETF映射需要注释来源
- 更新相关文档 (README + V7.3_SUBINDUSTRY_SIGMA_ANALYSIS.md)
- 提交信息清晰明确

---

## 📞 联系方式

- **GitHub**: [@LpcPaul](https://github.com/LpcPaul)
- **项目主页**: https://github.com/LpcPaul/downrisk-get
- **Issues**: https://github.com/LpcPaul/downrisk-get/issues

---

## 📄 许可证

MIT License - 详见 LICENSE 文件

---

## 🙏 致谢

- **数据来源**：[yfinance](https://github.com/ranaroussi/yfinance)
- **计算框架**：基于现代投资组合理论和下行风险理论
- **灵感来源**：Peter Bernstein的《风险》、Harry Markowitz的投资组合理论

---

**最后更新**: 2025-10-07
**版本**: V7.3 (细分行业σ_down + 2025Q3数据更新)
**维护者**: @LpcPaul

---

**⭐ 如果这个项目对你有帮助，请给个Star！**
